<div>Teachable Machine Image Model - p5.js and ml5.js</div>
<script src="../scripts/p5.min.js"></script>
<script src="../scripts/p5.dom.min.js"></script>
<script src="../scripts/ml5.min.js"></script>
<script type="text/javascript">
	// Model URL
	let classifier;
	let imageModelURL = './model/';
	let img;
	let imgName;
	let temp_imgName;
	let currentIndex = -2;
	let allImages = [];
	let predictions = [];  
	let label = "";

	var connection = new WebSocket('ws://127.0.0.1:8887');
	connection.onopen = function () {
	  //connection.send('Ping from js');
	  connection.send('restart');
	};    
 connection.onmessage = function (event) {
   imgName=event.data;
   temp_imgName=(' ' + imgName).slice(1);
	  currentIndex++;
   if (!imgName.includes('Welcome to the server!') && !imgName.includes('[new client connection]: 127.0.0.1') ) {
		loadImage(temp_imgName, imageReady);
	  }else{
		loadImage('../temp.jpg', imageReady);
	   }
	  createDiv('image: ' +currentIndex+':'+ temp_imgName+':'+label);
	  console.log(temp_imgName+':'+label);
	  connection.send(temp_imgName+':'+label);
 };    
	// Load the model first
	function preload() {
	  currentIndex=-2;
	  console.log("merhaba\n");
	  classifier = ml5.imageClassifier(imageModelURL + 'model.json');
	}
	// The function below will determine and setup the image sizes, get the results as image.
	function setup() {
	  currentIndex=-2;
	  createCanvas(224, 224);
	  background(0);
	  loadImage('../temp.jpg', imageReady);
	}

	function imageReady(img) {
	  image(img, 0, 0);
	  classifier.classify(img, gotResult);
	}

	function savePredictions() {
	  predictionsJSON = {
		predictions: predictions
	  };
	  saveJSON(predictionsJSON, 'predictions.json');
	}

	// When we get the results
	function gotResult(err, results) {
	  // If there is an error, show in the console
	  if (err) {
		console.error(err);
	  }

	  information = {
		name: allImages[currentIndex],
		result: results
	  };

	  label=results[0].label;
	  
	}
</script>
